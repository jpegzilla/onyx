<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="./css/main.min.css" />
    <link rel="icon" href="assets/img/icons/png/favicon-alt.png" />
    <link rel="manifest" href="manifest.json" />

    <title>onyx &mdash; chromatics research system</title>
  </head>

  <noscript
    >looks like you have javascript disabled. sorry, but there's just no way for
    onyx to work without it! please re-enable javascript if you'd like to use
    onyx.</noscript
  >

  <body>
    <onyx-loading-screen></onyx-loading-screen>

    <div class="no-mobile">
      <span
        >onyx isn't ready to be crammed into such a small space! I'm working on
        it.</span
      >
    </div>

    <!-- modal containers go here -->
    <onyx-drop-target></onyx-drop-target>
    <onyx-palette-modal></onyx-palette-modal>

    <main>
      <onyx-header></onyx-header>
      <onyx-color-display></onyx-color-display>
      <onyx-sidebar></onyx-sidebar>
      <onyx-controls></onyx-controls>
      <onyx-footer></onyx-footer>
    </main>
  </body>

  <script src="./js/main.mjs" type="module" charset="utf-8"></script>

  <script type="text/javascript">
    window.isUpdateAvailable = new Promise((resolve, reject) => {
      if (
        'serviceWorker' in navigator &&
        !['127.0.0.1', 'localhost'].includes(window.location.hostname)
      ) {
        // register service worker file
        navigator.serviceWorker
          .register('./service-worker.mjs')
          .then(reg => {
            console.log('[serviceworker] registered. ', reg.scope)

            reg.onupdatefound = () => {
              console.log('[serviceworker] update found. requesting update')
              const installingWorker = reg.installing
              installingWorker.onstatechange = () => {
                switch (installingWorker.state) {
                  case 'installed':
                    if (navigator.serviceWorker.controller) {
                      window.localStorage.setItem('onyxUpdateAvailable', true)
                      resolve(true)
                    } else {
                      window.localStorage.setItem('onyxUpdateAvailable', false)
                      resolve(false)
                    }
                    break
                }
              }
            }
          })
          .catch(err => console.error('[serviceworker] error: ', err))
      }
    })
  </script>
</html>
